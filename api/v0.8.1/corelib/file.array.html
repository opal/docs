<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: array
  
    &mdash; corelib (Opal v0.8.1)
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "array";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="file_list.html"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: array</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <iframe id="search_frame" src="file_list.html"></iframe>

      <div id="content"><div id='filecontents'><pre class="code ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>corelib/enumerable</span><span class='tstring_end'>&#39;</span></span>

<span class='kw'>class</span> <span class='const'>Array</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Enumerable</span>

  <span class='comment'># Mark all javascript arrays as being valid ruby arrays
</span>  <span class='backtick'>`</span><span class='tstring_content'>def.$$is_array = true</span><span class='tstring_end'>`</span></span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='op'>[]</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_objects'>objects</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_objects'>objects</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_size'>size</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_obj'>obj</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='backtick'>`</span><span class='tstring_content'>arguments.length &gt; 2</span><span class='tstring_end'>`</span></span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wrong number of arguments (</span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>arguments.length</span><span class='tstring_end'>`</span></span><span class='embexpr_end'>}</span><span class='tstring_content'> for 0..2)</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='backtick'>`</span><span class='tstring_content'>arguments.length === 0</span><span class='tstring_end'>`</span></span>
      <span class='kw'>return</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='backtick'>`</span><span class='tstring_content'>arguments.length === 1</span><span class='tstring_end'>`</span></span>
      <span class='kw'>if</span> <span class='const'>Array</span> <span class='op'>===</span> <span class='id identifier rubyid_size'>size</span>
        <span class='kw'>return</span> <span class='id identifier rubyid_size'>size</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>
      <span class='kw'>elsif</span> <span class='id identifier rubyid_size'>size</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span> <span class='symbol'>:to_ary</span>
        <span class='kw'>return</span> <span class='id identifier rubyid_size'>size</span><span class='period'>.</span><span class='id identifier rubyid_to_ary'>to_ary</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_size'>size</span> <span class='op'>=</span> <span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_coerce_to'>coerce_to</span> <span class='id identifier rubyid_size'>size</span><span class='comma'>,</span> <span class='const'>Integer</span><span class='comma'>,</span> <span class='symbol'>:to_int</span>

    <span class='kw'>if</span> <span class='backtick'>`</span><span class='tstring_content'>size &lt; 0</span><span class='tstring_end'>`</span></span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>negative array size</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='backtick'>%x{</span><span class='tstring_content'>
      var result = [];

      if (block === nil) {
        for (var i = 0; i &lt; size; i++) {
          result.push(obj);
        }
      }
      else {
        for (var i = 0, value; i &lt; size; i++) {
          value = block(i);

          if (value === $breaker) {
            return $breaker.$v;
          }

          result[i] = value;
        }
      }

      return result;
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_try_convert'>try_convert</span><span class='lparen'>(</span><span class='id identifier rubyid_obj'>obj</span><span class='rparen'>)</span>
    <span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_coerce_to?'>coerce_to?</span> <span class='id identifier rubyid_obj'>obj</span><span class='comma'>,</span> <span class='const'>Array</span><span class='comma'>,</span> <span class='symbol'>:to_ary</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='op'>&amp;</span><span class='lparen'>(</span><span class='id identifier rubyid_other'>other</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='const'>Array</span> <span class='op'>===</span> <span class='id identifier rubyid_other'>other</span>
      <span class='id identifier rubyid_other'>other</span> <span class='op'>=</span> <span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_other'>other</span> <span class='op'>=</span> <span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_coerce_to'>coerce_to</span><span class='lparen'>(</span><span class='id identifier rubyid_other'>other</span><span class='comma'>,</span> <span class='const'>Array</span><span class='comma'>,</span> <span class='symbol'>:to_ary</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>
    <span class='kw'>end</span>

    <span class='backtick'>%x{</span><span class='tstring_content'>
      var result = [],
          seen   = {};

      for (var i = 0, length = self.length; i &lt; length; i++) {
        var item = self[i];

        if (!seen[item]) {
          for (var j = 0, length2 = other.length; j &lt; length2; j++) {
            var item2 = other[j];

            if (!seen[item2] &amp;&amp; </span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>item</span><span class='tstring_end'>`</span></span> <span class='op'>==</span> <span class='backtick'>`</span><span class='tstring_content'>item2</span><span class='tstring_end'>`</span></span><span class='embexpr_end'>}</span><span class='tstring_content'>) {
              seen[item] = true;
              result.push(item);
            }
          }
        }
      }

      return result;
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='op'>|</span><span class='lparen'>(</span><span class='id identifier rubyid_other'>other</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='const'>Array</span> <span class='op'>===</span> <span class='id identifier rubyid_other'>other</span>
      <span class='id identifier rubyid_other'>other</span> <span class='op'>=</span> <span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_other'>other</span> <span class='op'>=</span> <span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_coerce_to'>coerce_to</span><span class='lparen'>(</span><span class='id identifier rubyid_other'>other</span><span class='comma'>,</span> <span class='const'>Array</span><span class='comma'>,</span> <span class='symbol'>:to_ary</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>
    <span class='kw'>end</span>

    <span class='backtick'>%x{</span><span class='tstring_content'>
      var result = [],
          seen   = {};

      for (var i = 0, length = self.length; i &lt; length; i++) {
        var item = self[i];

        if (!seen[item]) {
          seen[item] = true;
          result.push(item);
        }
      }

      for (var i = 0, length = other.length; i &lt; length; i++) {
        var item = other[i];

        if (!seen[item]) {
          seen[item] = true;
          result.push(item);
        }
      }
      return result;
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='op'>*</span><span class='lparen'>(</span><span class='id identifier rubyid_other'>other</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='backtick'>`</span><span class='tstring_content'>self.join(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_to_str'>to_str</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>`</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span> <span class='symbol'>:to_str</span>

    <span class='kw'>unless</span> <span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span> <span class='symbol'>:to_int</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>TypeError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>no implicit conversion of </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> into Integer</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_other'>other</span> <span class='op'>=</span> <span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_coerce_to'>coerce_to</span> <span class='id identifier rubyid_other'>other</span><span class='comma'>,</span> <span class='const'>Integer</span><span class='comma'>,</span> <span class='symbol'>:to_int</span>

    <span class='kw'>if</span> <span class='backtick'>`</span><span class='tstring_content'>other &lt; 0</span><span class='tstring_end'>`</span></span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>negative argument</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='backtick'>%x{</span><span class='tstring_content'>
      var result = [];

      for (var i = 0; i &lt; other; i++) {
        result = result.concat(self);
      }

      return result;
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='op'>+</span><span class='lparen'>(</span><span class='id identifier rubyid_other'>other</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='const'>Array</span> <span class='op'>===</span> <span class='id identifier rubyid_other'>other</span>
      <span class='id identifier rubyid_other'>other</span> <span class='op'>=</span> <span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_other'>other</span> <span class='op'>=</span> <span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_coerce_to'>coerce_to</span><span class='lparen'>(</span><span class='id identifier rubyid_other'>other</span><span class='comma'>,</span> <span class='const'>Array</span><span class='comma'>,</span> <span class='symbol'>:to_ary</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>
    <span class='kw'>end</span>

    <span class='backtick'>`</span><span class='tstring_content'>self.concat(other)</span><span class='tstring_end'>`</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='op'>-</span><span class='lparen'>(</span><span class='id identifier rubyid_other'>other</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='const'>Array</span> <span class='op'>===</span> <span class='id identifier rubyid_other'>other</span>
      <span class='id identifier rubyid_other'>other</span> <span class='op'>=</span> <span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_other'>other</span> <span class='op'>=</span> <span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_coerce_to'>coerce_to</span><span class='lparen'>(</span><span class='id identifier rubyid_other'>other</span><span class='comma'>,</span> <span class='const'>Array</span><span class='comma'>,</span> <span class='symbol'>:to_ary</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='backtick'>`</span><span class='tstring_content'>self.length === 0</span><span class='tstring_end'>`</span></span>
    <span class='kw'>return</span> <span class='id identifier rubyid_clone'>clone</span> <span class='kw'>if</span> <span class='backtick'>`</span><span class='tstring_content'>other.length === 0</span><span class='tstring_end'>`</span></span>

    <span class='backtick'>%x{</span><span class='tstring_content'>
      var seen   = {},
          result = [];

      for (var i = 0, length = other.length; i &lt; length; i++) {
        seen[other[i]] = true;
      }

      for (var i = 0, length = self.length; i &lt; length; i++) {
        var item = self[i];

        if (!seen[item]) {
          result.push(item);
        }
      }

      return result;
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='op'>&lt;&lt;</span><span class='lparen'>(</span><span class='id identifier rubyid_object'>object</span><span class='rparen'>)</span>
    <span class='backtick'>`</span><span class='tstring_content'>self.push(object);</span><span class='tstring_end'>`</span></span>

    <span class='kw'>self</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='op'>&lt;=&gt;</span><span class='lparen'>(</span><span class='id identifier rubyid_other'>other</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='const'>Array</span> <span class='op'>===</span> <span class='id identifier rubyid_other'>other</span>
      <span class='id identifier rubyid_other'>other</span> <span class='op'>=</span> <span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span> <span class='symbol'>:to_ary</span>
      <span class='id identifier rubyid_other'>other</span> <span class='op'>=</span> <span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_to_ary'>to_ary</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>
    <span class='kw'>else</span>
      <span class='kw'>return</span>
    <span class='kw'>end</span>

    <span class='backtick'>%x{</span><span class='tstring_content'>
      if (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_hash'>hash</span><span class='embexpr_end'>}</span><span class='tstring_content'> === </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_hash'>hash</span><span class='embexpr_end'>}</span><span class='tstring_content'>) {
        return 0;
      }

      if (self.length != other.length) {
        return (self.length &gt; other.length) ? 1 : -1;
      }

      for (var i = 0, length = self.length; i &lt; length; i++) {
        var tmp = </span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>self[i]</span><span class='tstring_end'>`</span></span> <span class='op'>&lt;=&gt;</span> <span class='backtick'>`</span><span class='tstring_content'>other[i]</span><span class='tstring_end'>`</span></span><span class='embexpr_end'>}</span><span class='tstring_content'>;

        if (tmp !== 0) {
          return tmp;
        }
      }

      return 0;
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='op'>==</span><span class='lparen'>(</span><span class='id identifier rubyid_other'>other</span><span class='rparen'>)</span>
    <span class='backtick'>%x{</span><span class='tstring_content'>
      var recursed = {};

      function _eqeq(array, other) {
        var i, length, a, b;

        if (!other.$$is_array) {
          if (</span><span class='embexpr_beg'>#{</span><span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span> <span class='backtick'>`</span><span class='tstring_content'>other</span><span class='tstring_end'>`</span></span><span class='comma'>,</span> <span class='symbol'>:to_ary</span><span class='embexpr_end'>}</span><span class='tstring_content'>) {
            return </span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>other</span><span class='tstring_end'>`</span></span> <span class='op'>==</span> <span class='backtick'>`</span><span class='tstring_content'>array</span><span class='tstring_end'>`</span></span><span class='embexpr_end'>}</span><span class='tstring_content'>;
          } else {
            return false;
          }
        }

        other = </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span><span class='embexpr_end'>}</span><span class='tstring_content'>;

        if (array.length !== other.length) {
          return false;
        }

        recursed[</span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>array</span><span class='tstring_end'>`</span></span><span class='period'>.</span><span class='id identifier rubyid_object_id'>object_id</span><span class='embexpr_end'>}</span><span class='tstring_content'>] = true;

        for (i = 0, length = array.length; i &lt; length; i++) {
          a = array[i];
          b = other[i];
          if (a.$$is_array) {
            if (b.$$is_array &amp;&amp; b.length !== a.length) {
              return false;
            }
            if (!recursed.hasOwnProperty(</span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>a</span><span class='tstring_end'>`</span></span><span class='period'>.</span><span class='id identifier rubyid_object_id'>object_id</span><span class='embexpr_end'>}</span><span class='tstring_content'>)) {
              if (!_eqeq(a, b)) {
                return false;
              }
            }
          } else {
            if (!</span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>a</span><span class='tstring_end'>`</span></span> <span class='op'>==</span> <span class='backtick'>`</span><span class='tstring_content'>b</span><span class='tstring_end'>`</span></span><span class='embexpr_end'>}</span><span class='tstring_content'>) {
              return false;
            }
          }
        }

        return true;
      }

      return _eqeq(self, other);
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='op'>[]</span><span class='lparen'>(</span><span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_length'>length</span> <span class='op'>=</span> <span class='id identifier rubyid_undefined'>undefined</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='const'>Range</span> <span class='op'>===</span> <span class='id identifier rubyid_index'>index</span>
      <span class='backtick'>%x{</span><span class='tstring_content'>
        var size    = self.length,
            exclude = index.exclude,
            from    = </span><span class='embexpr_beg'>#{</span><span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_coerce_to'>coerce_to</span> <span class='backtick'>`</span><span class='tstring_content'>index.begin</span><span class='tstring_end'>`</span></span><span class='comma'>,</span> <span class='const'>Integer</span><span class='comma'>,</span> <span class='symbol'>:to_int</span><span class='embexpr_end'>}</span><span class='tstring_content'>,
            to      = </span><span class='embexpr_beg'>#{</span><span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_coerce_to'>coerce_to</span> <span class='backtick'>`</span><span class='tstring_content'>index.end</span><span class='tstring_end'>`</span></span><span class='comma'>,</span> <span class='const'>Integer</span><span class='comma'>,</span> <span class='symbol'>:to_int</span><span class='embexpr_end'>}</span><span class='tstring_content'>;

        if (from &lt; 0) {
          from += size;

          if (from &lt; 0) {
            return nil;
          }
        }

        if (from &gt; size) {
          return nil;
        }

        if (to &lt; 0) {
          to += size;

          if (to &lt; 0) {
            return [];
          }
        }

        if (!exclude) {
          to += 1;
        }

        return self.slice(from, to);
      </span><span class='tstring_end'>}</span></span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_index'>index</span> <span class='op'>=</span> <span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_coerce_to'>coerce_to</span> <span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='const'>Integer</span><span class='comma'>,</span> <span class='symbol'>:to_int</span>

      <span class='backtick'>%x{</span><span class='tstring_content'>
        var size = self.length;

        if (index &lt; 0) {
          index += size;

          if (index &lt; 0) {
            return nil;
          }
        }

        if (length === undefined) {
          if (index &gt;= size || index &lt; 0) {
            return nil;
          }

          return self[index];
        }
        else {
          length = </span><span class='embexpr_beg'>#{</span><span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_coerce_to'>coerce_to</span> <span class='id identifier rubyid_length'>length</span><span class='comma'>,</span> <span class='const'>Integer</span><span class='comma'>,</span> <span class='symbol'>:to_int</span><span class='embexpr_end'>}</span><span class='tstring_content'>;

          if (length &lt; 0 || index &gt; size || index &lt; 0) {
            return nil;
          }

          return self.slice(index, index + length);
        }
      </span><span class='tstring_end'>}</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='op'>[]=</span><span class='lparen'>(</span><span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='comma'>,</span> <span class='id identifier rubyid_extra'>extra</span> <span class='op'>=</span> <span class='id identifier rubyid_undefined'>undefined</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='const'>Range</span> <span class='op'>===</span> <span class='id identifier rubyid_index'>index</span>
      <span class='kw'>if</span> <span class='const'>Array</span> <span class='op'>===</span> <span class='id identifier rubyid_value'>value</span>
        <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>
      <span class='kw'>elsif</span> <span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span> <span class='symbol'>:to_ary</span>
        <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_to_ary'>to_ary</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_value'>value</span><span class='rbracket'>]</span>
      <span class='kw'>end</span>

      <span class='backtick'>%x{</span><span class='tstring_content'>
        var size    = self.length,
            exclude = index.exclude,
            from    = </span><span class='embexpr_beg'>#{</span><span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_coerce_to'>coerce_to</span> <span class='backtick'>`</span><span class='tstring_content'>index.begin</span><span class='tstring_end'>`</span></span><span class='comma'>,</span> <span class='const'>Integer</span><span class='comma'>,</span> <span class='symbol'>:to_int</span><span class='embexpr_end'>}</span><span class='tstring_content'>,
            to      = </span><span class='embexpr_beg'>#{</span><span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_coerce_to'>coerce_to</span> <span class='backtick'>`</span><span class='tstring_content'>index.end</span><span class='tstring_end'>`</span></span><span class='comma'>,</span> <span class='const'>Integer</span><span class='comma'>,</span> <span class='symbol'>:to_int</span><span class='embexpr_end'>}</span><span class='tstring_content'>;

        if (from &lt; 0) {
          from += size;

          if (from &lt; 0) {
            </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_raise'>raise</span> <span class='const'>RangeError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_index'>index</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> out of range</span><span class='tstring_end'>&quot;</span></span><span class='embexpr_end'>}</span><span class='tstring_content'>;
          }
        }

        if (to &lt; 0) {
          to += size;
        }

        if (!exclude) {
          to += 1;
        }

        if (from &gt; size) {
          for (var i = size; i &lt; from; i++) {
            self[i] = nil;
          }
        }

        if (to &lt; 0) {
          self.splice.apply(self, [from, 0].concat(data));
        }
        else {
          self.splice.apply(self, [from, to - from].concat(data));
        }

        return value;
      </span><span class='tstring_end'>}</span></span>
    <span class='kw'>else</span>
      <span class='kw'>if</span> <span class='backtick'>`</span><span class='tstring_content'>extra === undefined</span><span class='tstring_end'>`</span></span>
        <span class='id identifier rubyid_length'>length</span> <span class='op'>=</span> <span class='int'>1</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_length'>length</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span>
        <span class='id identifier rubyid_value'>value</span>  <span class='op'>=</span> <span class='id identifier rubyid_extra'>extra</span>

        <span class='kw'>if</span> <span class='const'>Array</span> <span class='op'>===</span> <span class='id identifier rubyid_value'>value</span>
          <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>
        <span class='kw'>elsif</span> <span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span> <span class='symbol'>:to_ary</span>
          <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_to_ary'>to_ary</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_value'>value</span><span class='rbracket'>]</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>

      <span class='backtick'>%x{</span><span class='tstring_content'>
        var size   = self.length,
            index  = </span><span class='embexpr_beg'>#{</span><span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_coerce_to'>coerce_to</span> <span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='const'>Integer</span><span class='comma'>,</span> <span class='symbol'>:to_int</span><span class='embexpr_end'>}</span><span class='tstring_content'>,
            length = </span><span class='embexpr_beg'>#{</span><span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_coerce_to'>coerce_to</span> <span class='id identifier rubyid_length'>length</span><span class='comma'>,</span> <span class='const'>Integer</span><span class='comma'>,</span> <span class='symbol'>:to_int</span><span class='embexpr_end'>}</span><span class='tstring_content'>,
            old;

        if (index &lt; 0) {
          old    = index;
          index += size;

          if (index &lt; 0) {
            </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_raise'>raise</span> <span class='const'>IndexError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>index </span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>old</span><span class='tstring_end'>`</span></span><span class='embexpr_end'>}</span><span class='tstring_content'> too small for array; minimum </span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>-self.length</span><span class='tstring_end'>`</span></span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='embexpr_end'>}</span><span class='tstring_content'>;
          }
        }

        if (length &lt; 0) {
          </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_raise'>raise</span> <span class='const'>IndexError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>negative length (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_length'>length</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span><span class='embexpr_end'>}</span><span class='tstring_content'>
        }

        if (index &gt; size) {
          for (var i = size; i &lt; index; i++) {
            self[i] = nil;
          }
        }

        if (extra === undefined) {
          self[index] = value;
        }
        else {
          self.splice.apply(self, [index, length].concat(data));
        }

        return value;
      </span><span class='tstring_end'>}</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_assoc'>assoc</span><span class='lparen'>(</span><span class='id identifier rubyid_object'>object</span><span class='rparen'>)</span>
    <span class='backtick'>%x{</span><span class='tstring_content'>
      for (var i = 0, length = self.length, item; i &lt; length; i++) {
        if (item = self[i], item.length &amp;&amp; </span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>item[0]</span><span class='tstring_end'>`</span></span> <span class='op'>==</span> <span class='id identifier rubyid_object'>object</span><span class='embexpr_end'>}</span><span class='tstring_content'>) {
          return item;
        }
      }

      return nil;
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_at'>at</span><span class='lparen'>(</span><span class='id identifier rubyid_index'>index</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_index'>index</span> <span class='op'>=</span> <span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_coerce_to'>coerce_to</span> <span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='const'>Integer</span><span class='comma'>,</span> <span class='symbol'>:to_int</span>

    <span class='backtick'>%x{</span><span class='tstring_content'>
      if (index &lt; 0) {
        index += self.length;
      }

      if (index &lt; 0 || index &gt;= self.length) {
        return nil;
      }

      return self[index];
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_bsearch'>bsearch</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_enum_for'>enum_for</span> <span class='symbol'>:bsearch</span> <span class='kw'>unless</span> <span class='id identifier rubyid_block_given?'>block_given?</span>

    <span class='backtick'>%x{</span><span class='tstring_content'>
      var min = 0,
          max = self.length,
          mid,
          val,
          ret,
          smaller = false,
          satisfied = nil;

      while (min &lt; max) {
        mid = min + Math.floor((max - min) / 2);
        val = self[mid];
        ret = block(val);

        if (ret === $breaker) {
          return $breaker.$v;
        }
        else if (ret === true) {
          satisfied = val;
          smaller = true;
        }
        else if (ret === false || ret === nil) {
          smaller = false;
        }
        else if (ret.$$is_number) {
          if (ret === 0) { return val; }
          smaller = (ret &lt; 0);
        }
        else {
          </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_raise'>raise</span> <span class='const'>TypeError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wrong argument type </span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>ret</span><span class='tstring_end'>`</span></span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> (must be numeric, true, false or nil)</span><span class='tstring_end'>&quot;</span></span><span class='embexpr_end'>}</span><span class='tstring_content'>
        }

        if (smaller) { max = mid; } else { min = mid + 1; }
      }

      return satisfied;
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_cycle'>cycle</span><span class='lparen'>(</span><span class='id identifier rubyid_n'>n</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>if</span> <span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>||</span> <span class='id identifier rubyid_n'>n</span> <span class='op'>==</span> <span class='int'>0</span>

    <span class='kw'>return</span> <span class='id identifier rubyid_enum_for'>enum_for</span> <span class='symbol'>:cycle</span><span class='comma'>,</span> <span class='id identifier rubyid_n'>n</span> <span class='kw'>unless</span> <span class='id identifier rubyid_block'>block</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_n'>n</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='backtick'>%x{</span><span class='tstring_content'>
        while (true) {
          for (var i = 0, length = self.length; i &lt; length; i++) {
            var value = Opal.yield1(block, self[i]);

            if (value === $breaker) {
              return $breaker.$v;
            }
          }
        }
      </span><span class='tstring_end'>}</span></span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_n'>n</span> <span class='op'>=</span> <span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_coerce_to!'>coerce_to!</span> <span class='id identifier rubyid_n'>n</span><span class='comma'>,</span> <span class='const'>Integer</span><span class='comma'>,</span> <span class='symbol'>:to_int</span>

      <span class='backtick'>%x{</span><span class='tstring_content'>
        if (n &lt;= 0) {
          return self;
        }

        while (n &gt; 0) {
          for (var i = 0, length = self.length; i &lt; length; i++) {
            var value = Opal.yield1(block, self[i]);

            if (value === $breaker) {
              return $breaker.$v;
            }
          }

          n--;
        }
      </span><span class='tstring_end'>}</span></span>
    <span class='kw'>end</span>

    <span class='kw'>self</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_clear'>clear</span>
    <span class='backtick'>`</span><span class='tstring_content'>self.splice(0, self.length)</span><span class='tstring_end'>`</span></span>

    <span class='kw'>self</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_clone'>clone</span>
    <span class='id identifier rubyid_copy'>copy</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_copy'>copy</span><span class='period'>.</span><span class='id identifier rubyid_initialize_clone'>initialize_clone</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_copy'>copy</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_dup'>dup</span>
    <span class='id identifier rubyid_copy'>copy</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_copy'>copy</span><span class='period'>.</span><span class='id identifier rubyid_initialize_dup'>initialize_dup</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_copy'>copy</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_initialize_copy'>initialize_copy</span><span class='lparen'>(</span><span class='id identifier rubyid_other'>other</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_replace'>replace</span> <span class='id identifier rubyid_other'>other</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_collect'>collect</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_enum_for'>enum_for</span> <span class='symbol'>:collect</span> <span class='kw'>unless</span> <span class='id identifier rubyid_block_given?'>block_given?</span>

    <span class='backtick'>%x{</span><span class='tstring_content'>
      var result = [];

      for (var i = 0, length = self.length; i &lt; length; i++) {
        var value = Opal.yield1(block, self[i]);

        if (value === $breaker) {
          return $breaker.$v;
        }

        result.push(value);
      }

      return result;
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_collect!'>collect!</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_enum_for'>enum_for</span> <span class='symbol'>:collect!</span> <span class='kw'>unless</span> <span class='id identifier rubyid_block_given?'>block_given?</span>

    <span class='backtick'>%x{</span><span class='tstring_content'>
      for (var i = 0, length = self.length; i &lt; length; i++) {
        var value = Opal.yield1(block, self[i]);

        if (value === $breaker) {
          return $breaker.$v;
        }

        self[i] = value;
      }
    </span><span class='tstring_end'>}</span></span>

    <span class='kw'>self</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_combination'>combination</span><span class='lparen'>(</span><span class='id identifier rubyid_n'>n</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_num'>num</span> <span class='op'>=</span> <span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_coerce_to!'>coerce_to!</span> <span class='id identifier rubyid_n'>n</span><span class='comma'>,</span> <span class='const'>Integer</span><span class='comma'>,</span> <span class='symbol'>:to_int</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_enum_for'>enum_for</span> <span class='symbol'>:combination</span><span class='comma'>,</span> <span class='id identifier rubyid_num'>num</span> <span class='kw'>unless</span> <span class='id identifier rubyid_block_given?'>block_given?</span>

    <span class='backtick'>%x{</span><span class='tstring_content'>
      var i, length, stack, chosen, lev, done, next;

      if (num === 0) {
        </span><span class='embexpr_beg'>#{</span><span class='kw'>yield</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>
      } else if (num === 1) {
        for (i = 0, length = self.length; i &lt; length; i++) {
          </span><span class='embexpr_beg'>#{</span><span class='kw'>yield</span> <span class='backtick'>`</span><span class='tstring_content'>[self[i]]</span><span class='tstring_end'>`</span></span><span class='embexpr_end'>}</span><span class='tstring_content'>
        }
      }
      else if (num === self.length) {
        </span><span class='embexpr_beg'>#{</span><span class='kw'>yield</span> <span class='backtick'>`</span><span class='tstring_content'>self.slice()</span><span class='tstring_end'>`</span></span><span class='embexpr_end'>}</span><span class='tstring_content'>
      }
      else if (num &gt;= 0 &amp;&amp; num &lt; self.length) {
        stack = [];
        for (i = 0; i &lt;= num + 1; i++) {
          stack.push(0);
        }

        chosen = [];
        lev = 0;
        done = false;
        stack[0] = -1;

        while (!done) {
          chosen[lev] = self[stack[lev+1]];
          while (lev &lt; num - 1) {
            lev++;
            next = stack[lev+1] = stack[lev] + 1;
            chosen[lev] = self[next];
          }
          </span><span class='embexpr_beg'>#{</span> <span class='kw'>yield</span> <span class='backtick'>`</span><span class='tstring_content'>chosen.slice()</span><span class='tstring_end'>`</span></span> <span class='embexpr_end'>}</span><span class='tstring_content'>
          lev++;
          do {
            done = (lev === 0);
            stack[lev]++;
            lev--;
          } while ( stack[lev+1] + num === self.length + lev + 1 );
        }
      }
    </span><span class='tstring_end'>}</span></span>
    <span class='kw'>self</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_compact'>compact</span>
    <span class='backtick'>%x{</span><span class='tstring_content'>
      var result = [];

      for (var i = 0, length = self.length, item; i &lt; length; i++) {
        if ((item = self[i]) !== nil) {
          result.push(item);
        }
      }

      return result;
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_compact!'>compact!</span>
    <span class='backtick'>%x{</span><span class='tstring_content'>
      var original = self.length;

      for (var i = 0, length = self.length; i &lt; length; i++) {
        if (self[i] === nil) {
          self.splice(i, 1);

          length--;
          i--;
        }
      }

      return self.length === original ? nil : self;
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_concat'>concat</span><span class='lparen'>(</span><span class='id identifier rubyid_other'>other</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='const'>Array</span> <span class='op'>===</span> <span class='id identifier rubyid_other'>other</span>
      <span class='id identifier rubyid_other'>other</span> <span class='op'>=</span> <span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_other'>other</span> <span class='op'>=</span> <span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_coerce_to'>coerce_to</span><span class='lparen'>(</span><span class='id identifier rubyid_other'>other</span><span class='comma'>,</span> <span class='const'>Array</span><span class='comma'>,</span> <span class='symbol'>:to_ary</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>
    <span class='kw'>end</span>

    <span class='backtick'>%x{</span><span class='tstring_content'>
      for (var i = 0, length = other.length; i &lt; length; i++) {
        self.push(other[i]);
      }
    </span><span class='tstring_end'>}</span></span>

    <span class='kw'>self</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_object'>object</span><span class='rparen'>)</span>
    <span class='backtick'>%x{</span><span class='tstring_content'>
      var original = self.length;

      for (var i = 0, length = original; i &lt; length; i++) {
        if (</span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>self[i]</span><span class='tstring_end'>`</span></span> <span class='op'>==</span> <span class='id identifier rubyid_object'>object</span><span class='embexpr_end'>}</span><span class='tstring_content'>) {
          self.splice(i, 1);

          length--;
          i--;
        }
      }

      if (self.length === original) {
        if (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_block_given?'>block_given?</span><span class='embexpr_end'>}</span><span class='tstring_content'>) {
          return </span><span class='embexpr_beg'>#{</span><span class='kw'>yield</span><span class='embexpr_end'>}</span><span class='tstring_content'>;
        }
        return nil;
      }
      return object;
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_delete_at'>delete_at</span><span class='lparen'>(</span><span class='id identifier rubyid_index'>index</span><span class='rparen'>)</span>
    <span class='backtick'>%x{</span><span class='tstring_content'>
      index = </span><span class='embexpr_beg'>#{</span><span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_coerce_to'>coerce_to</span> <span class='backtick'>`</span><span class='tstring_content'>index</span><span class='tstring_end'>`</span></span><span class='comma'>,</span> <span class='const'>Integer</span><span class='comma'>,</span> <span class='symbol'>:to_int</span><span class='embexpr_end'>}</span><span class='tstring_content'>;

      if (index &lt; 0) {
        index += self.length;
      }

      if (index &lt; 0 || index &gt;= self.length) {
        return nil;
      }

      var result = self[index];

      self.splice(index, 1);

      return result;
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_delete_if'>delete_if</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_enum_for'>enum_for</span> <span class='symbol'>:delete_if</span> <span class='kw'>unless</span> <span class='id identifier rubyid_block_given?'>block_given?</span>

    <span class='backtick'>%x{</span><span class='tstring_content'>
      for (var i = 0, length = self.length, value; i &lt; length; i++) {
        if ((value = block(self[i])) === $breaker) {
          return $breaker.$v;
        }

        if (value !== false &amp;&amp; value !== nil) {
          self.splice(i, 1);

          length--;
          i--;
        }
      }
    </span><span class='tstring_end'>}</span></span>

    <span class='kw'>self</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_drop'>drop</span><span class='lparen'>(</span><span class='id identifier rubyid_number'>number</span><span class='rparen'>)</span>
    <span class='backtick'>%x{</span><span class='tstring_content'>
      if (number &lt; 0) {
        </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='embexpr_end'>}</span><span class='tstring_content'>
      }

      return self.slice(number);
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>end</span>

  <span class='kw'>alias</span> <span class='id identifier rubyid_dup'>dup</span> <span class='id identifier rubyid_clone'>clone</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_enum_for'>enum_for</span> <span class='symbol'>:each</span> <span class='kw'>unless</span> <span class='id identifier rubyid_block_given?'>block_given?</span>

    <span class='backtick'>%x{</span><span class='tstring_content'>
      for (var i = 0, length = self.length; i &lt; length; i++) {
        var value = Opal.yield1(block, self[i]);

        if (value == $breaker) {
          return $breaker.$v;
        }
      }
    </span><span class='tstring_end'>}</span></span>

    <span class='kw'>self</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_each_index'>each_index</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_enum_for'>enum_for</span> <span class='symbol'>:each_index</span> <span class='kw'>unless</span> <span class='id identifier rubyid_block_given?'>block_given?</span>

    <span class='backtick'>%x{</span><span class='tstring_content'>
      for (var i = 0, length = self.length; i &lt; length; i++) {
        var value = Opal.yield1(block, i);

        if (value === $breaker) {
          return $breaker.$v;
        }
      }
    </span><span class='tstring_end'>}</span></span>

    <span class='kw'>self</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_empty?'>empty?</span>
    <span class='backtick'>`</span><span class='tstring_content'>self.length === 0</span><span class='tstring_end'>`</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_eql?'>eql?</span><span class='lparen'>(</span><span class='id identifier rubyid_other'>other</span><span class='rparen'>)</span>
    <span class='backtick'>%x{</span><span class='tstring_content'>
      var recursed = {};

      function _eql(array, other) {
        var i, length, a, b;

        if (!other.$$is_array) {
          return false;
        }

        other = </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span><span class='embexpr_end'>}</span><span class='tstring_content'>;

        if (array.length !== other.length) {
          return false;
        }

        recursed[</span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>array</span><span class='tstring_end'>`</span></span><span class='period'>.</span><span class='id identifier rubyid_object_id'>object_id</span><span class='embexpr_end'>}</span><span class='tstring_content'>] = true;

        for (i = 0, length = array.length; i &lt; length; i++) {
          a = array[i];
          b = other[i];
          if (a.$$is_array) {
            if (b.$$is_array &amp;&amp; b.length !== a.length) {
              return false;
            }
            if (!recursed.hasOwnProperty(</span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>a</span><span class='tstring_end'>`</span></span><span class='period'>.</span><span class='id identifier rubyid_object_id'>object_id</span><span class='embexpr_end'>}</span><span class='tstring_content'>)) {
              if (!_eql(a, b)) {
                return false;
              }
            }
          } else {
            if (!</span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>a</span><span class='tstring_end'>`</span></span><span class='period'>.</span><span class='id identifier rubyid_eql?'>eql?</span><span class='lparen'>(</span><span class='backtick'>`</span><span class='tstring_content'>b</span><span class='tstring_end'>`</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>) {
              return false;
            }
          }
        }

        return true;
      }

      return _eql(self, other);
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_defaults'>defaults</span> <span class='op'>=</span> <span class='id identifier rubyid_undefined'>undefined</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='backtick'>%x{</span><span class='tstring_content'>
      var original = index;

      index = </span><span class='embexpr_beg'>#{</span><span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_coerce_to'>coerce_to</span> <span class='backtick'>`</span><span class='tstring_content'>index</span><span class='tstring_end'>`</span></span><span class='comma'>,</span> <span class='const'>Integer</span><span class='comma'>,</span> <span class='symbol'>:to_int</span><span class='embexpr_end'>}</span><span class='tstring_content'>;

      if (index &lt; 0) {
        index += self.length;
      }

      if (index &gt;= 0 &amp;&amp; index &lt; self.length) {
        return self[index];
      }

      if (block !== nil) {
        return block(original);
      }

      if (defaults != null) {
        return defaults;
      }

      if (self.length === 0) {
        </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_raise'>raise</span> <span class='const'>IndexError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>index </span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>original</span><span class='tstring_end'>`</span></span><span class='embexpr_end'>}</span><span class='tstring_content'> outside of array bounds: 0...0</span><span class='tstring_end'>&quot;</span></span><span class='embexpr_end'>}</span><span class='tstring_content'>
      }
      else {
        </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_raise'>raise</span> <span class='const'>IndexError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>index </span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>original</span><span class='tstring_end'>`</span></span><span class='embexpr_end'>}</span><span class='tstring_content'> outside of array bounds: -</span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>self.length</span><span class='tstring_end'>`</span></span><span class='embexpr_end'>}</span><span class='tstring_content'>...</span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>self.length</span><span class='tstring_end'>`</span></span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='embexpr_end'>}</span><span class='tstring_content'>;
      }
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_fill'>fill</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_block'>block</span>
      <span class='kw'>if</span> <span class='backtick'>`</span><span class='tstring_content'>args.length &gt; 2</span><span class='tstring_end'>`</span></span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wrong number of arguments (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_args'>args</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='embexpr_end'>}</span><span class='tstring_content'> for 0..2)</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_one'>one</span><span class='comma'>,</span> <span class='id identifier rubyid_two'>two</span> <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span>
    <span class='kw'>else</span>
      <span class='kw'>if</span> <span class='backtick'>`</span><span class='tstring_content'>args.length == 0</span><span class='tstring_end'>`</span></span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wrong number of arguments (0 for 1..3)</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>elsif</span> <span class='backtick'>`</span><span class='tstring_content'>args.length &gt; 3</span><span class='tstring_end'>`</span></span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wrong number of arguments (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_args'>args</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='embexpr_end'>}</span><span class='tstring_content'> for 1..3)</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_obj'>obj</span><span class='comma'>,</span> <span class='id identifier rubyid_one'>one</span><span class='comma'>,</span> <span class='id identifier rubyid_two'>two</span> <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='const'>Range</span> <span class='op'>===</span> <span class='id identifier rubyid_one'>one</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>TypeError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>length invalid with range</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_two'>two</span>

      <span class='id identifier rubyid_left'>left</span>   <span class='op'>=</span> <span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_coerce_to'>coerce_to</span> <span class='id identifier rubyid_one'>one</span><span class='period'>.</span><span class='id identifier rubyid_begin'>begin</span><span class='comma'>,</span> <span class='const'>Integer</span><span class='comma'>,</span> <span class='symbol'>:to_int</span>
      <span class='backtick'>`</span><span class='tstring_content'>left += </span><span class='embvar'>#</span><span class='ivar'>@length</span><span class='tstring_end'>`</span></span> <span class='kw'>if</span> <span class='backtick'>`</span><span class='tstring_content'>left &lt; 0</span><span class='tstring_end'>`</span></span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>RangeError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_one'>one</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> out of range</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='backtick'>`</span><span class='tstring_content'>left &lt; 0</span><span class='tstring_end'>`</span></span>

      <span class='id identifier rubyid_right'>right</span>  <span class='op'>=</span> <span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_coerce_to'>coerce_to</span> <span class='id identifier rubyid_one'>one</span><span class='period'>.</span><span class='id identifier rubyid_end'>end</span><span class='comma'>,</span> <span class='const'>Integer</span><span class='comma'>,</span> <span class='symbol'>:to_int</span>
      <span class='backtick'>`</span><span class='tstring_content'>right += </span><span class='embvar'>#</span><span class='ivar'>@length</span><span class='tstring_end'>`</span></span> <span class='kw'>if</span> <span class='backtick'>`</span><span class='tstring_content'>right &lt; 0</span><span class='tstring_end'>`</span></span>
      <span class='backtick'>`</span><span class='tstring_content'>right += 1</span><span class='tstring_end'>`</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_one'>one</span><span class='period'>.</span><span class='id identifier rubyid_exclude_end?'>exclude_end?</span>

      <span class='kw'>return</span> <span class='kw'>self</span> <span class='kw'>if</span> <span class='backtick'>`</span><span class='tstring_content'>right &lt;= left</span><span class='tstring_end'>`</span></span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_one'>one</span>
      <span class='id identifier rubyid_left'>left</span>   <span class='op'>=</span> <span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_coerce_to'>coerce_to</span> <span class='id identifier rubyid_one'>one</span><span class='comma'>,</span> <span class='const'>Integer</span><span class='comma'>,</span> <span class='symbol'>:to_int</span>
      <span class='backtick'>`</span><span class='tstring_content'>left += </span><span class='embvar'>#</span><span class='ivar'>@length</span><span class='tstring_end'>`</span></span> <span class='kw'>if</span> <span class='backtick'>`</span><span class='tstring_content'>left &lt; 0</span><span class='tstring_end'>`</span></span>
      <span class='id identifier rubyid_left'>left</span>   <span class='op'>=</span> <span class='int'>0</span> <span class='kw'>if</span> <span class='backtick'>`</span><span class='tstring_content'>left &lt; 0</span><span class='tstring_end'>`</span></span>

      <span class='kw'>if</span> <span class='id identifier rubyid_two'>two</span>
        <span class='id identifier rubyid_right'>right</span> <span class='op'>=</span> <span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_coerce_to'>coerce_to</span> <span class='id identifier rubyid_two'>two</span><span class='comma'>,</span> <span class='const'>Integer</span><span class='comma'>,</span> <span class='symbol'>:to_int</span>

        <span class='kw'>return</span> <span class='kw'>self</span> <span class='kw'>if</span> <span class='backtick'>`</span><span class='tstring_content'>right == 0</span><span class='tstring_end'>`</span></span>

        <span class='backtick'>`</span><span class='tstring_content'>right += left</span><span class='tstring_end'>`</span></span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_right'>right</span> <span class='op'>=</span> <span class='ivar'>@length</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_left'>left</span>  <span class='op'>=</span> <span class='int'>0</span>
      <span class='id identifier rubyid_right'>right</span> <span class='op'>=</span> <span class='ivar'>@length</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='backtick'>`</span><span class='tstring_content'>left &gt; </span><span class='embvar'>#</span><span class='ivar'>@length</span><span class='tstring_end'>`</span></span>
      <span class='backtick'>%x{</span><span class='tstring_content'>
        for (var i = </span><span class='embvar'>#</span><span class='ivar'>@length</span><span class='tstring_content'>; i &lt; right; i++) {
          self[i] = nil;
        }
      </span><span class='tstring_end'>}</span></span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='backtick'>`</span><span class='tstring_content'>right &gt; </span><span class='embvar'>#</span><span class='ivar'>@length</span><span class='tstring_end'>`</span></span>
      <span class='ivar'>@length</span> <span class='op'>=</span> <span class='id identifier rubyid_right'>right</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_block'>block</span>
      <span class='backtick'>%x{</span><span class='tstring_content'>
        for (var length = </span><span class='embvar'>#</span><span class='ivar'>@length</span><span class='tstring_content'>; left &lt; right; left++) {
          var value = block(left);

          if (value === $breaker) {
            return $breaker.$v;
          }

          self[left] = value;
        }
      </span><span class='tstring_end'>}</span></span>
    <span class='kw'>else</span>
      <span class='backtick'>%x{</span><span class='tstring_content'>
        for (var length = </span><span class='embvar'>#</span><span class='ivar'>@length</span><span class='tstring_content'>; left &lt; right; left++) {
          self[left] = </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_obj'>obj</span><span class='embexpr_end'>}</span><span class='tstring_content'>;
        }
      </span><span class='tstring_end'>}</span></span>
    <span class='kw'>end</span>

    <span class='kw'>self</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_first'>first</span><span class='lparen'>(</span><span class='id identifier rubyid_count'>count</span> <span class='op'>=</span> <span class='id identifier rubyid_undefined'>undefined</span><span class='rparen'>)</span>
    <span class='backtick'>%x{</span><span class='tstring_content'>
      if (count == null) {
        return self.length === 0 ? nil : self[0];
      }

      count = </span><span class='embexpr_beg'>#{</span><span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_coerce_to'>coerce_to</span> <span class='backtick'>`</span><span class='tstring_content'>count</span><span class='tstring_end'>`</span></span><span class='comma'>,</span> <span class='const'>Integer</span><span class='comma'>,</span> <span class='symbol'>:to_int</span><span class='embexpr_end'>}</span><span class='tstring_content'>;

      if (count &lt; 0) {
        </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>negative array size</span><span class='tstring_end'>&#39;</span></span><span class='embexpr_end'>}</span><span class='tstring_content'>;
      }

      return self.slice(0, count);
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_flatten'>flatten</span><span class='lparen'>(</span><span class='id identifier rubyid_level'>level</span> <span class='op'>=</span> <span class='id identifier rubyid_undefined'>undefined</span><span class='rparen'>)</span>
    <span class='backtick'>%x{</span><span class='tstring_content'>
      var object_id = </span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>self</span><span class='tstring_end'>`</span></span><span class='period'>.</span><span class='id identifier rubyid_object_id'>object_id</span><span class='embexpr_end'>}</span><span class='tstring_content'>;

      function _flatten(array, level) {
        var array = </span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>array</span><span class='tstring_end'>`</span></span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span><span class='embexpr_end'>}</span><span class='tstring_content'>,
            result = [],
            i, length,
            item, ary;

        for (i = 0, length = array.length; i &lt; length; i++) {
          item = array[i];

          if (!</span><span class='embexpr_beg'>#{</span><span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span> <span class='backtick'>`</span><span class='tstring_content'>item</span><span class='tstring_end'>`</span></span><span class='comma'>,</span> <span class='symbol'>:to_ary</span><span class='embexpr_end'>}</span><span class='tstring_content'>) {
            result.push(item);
            continue;
          }

          ary = </span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>item</span><span class='tstring_end'>`</span></span><span class='period'>.</span><span class='id identifier rubyid_to_ary'>to_ary</span><span class='embexpr_end'>}</span><span class='tstring_content'>;

          if (ary === nil) {
            result.push(item);
            continue;
          }

          if (!ary.$$is_array) {
            </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_raise'>raise</span> <span class='const'>TypeError</span><span class='embexpr_end'>}</span><span class='tstring_content'>;
          }

          if (object_id === </span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>ary</span><span class='tstring_end'>`</span></span><span class='period'>.</span><span class='id identifier rubyid_object_id'>object_id</span><span class='embexpr_end'>}</span><span class='tstring_content'>) {
            </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='embexpr_end'>}</span><span class='tstring_content'>;
          }

          switch (level) {
          case undefined:
            result.push.apply(result, _flatten(ary));
            break;
          case 0:
            result.push(ary);
            break;
          default:
            result.push.apply(result, _flatten(ary, level - 1));
          }
        }
        return result;
      }

      if (level !== undefined) {
        level = </span><span class='embexpr_beg'>#{</span><span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_coerce_to'>coerce_to</span><span class='lparen'>(</span><span class='backtick'>`</span><span class='tstring_content'>level</span><span class='tstring_end'>`</span></span><span class='comma'>,</span> <span class='const'>Integer</span><span class='comma'>,</span> <span class='symbol'>:to_int</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>;
      }

      return _flatten(self, level);
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_flatten!'>flatten!</span><span class='lparen'>(</span><span class='id identifier rubyid_level'>level</span> <span class='op'>=</span> <span class='id identifier rubyid_undefined'>undefined</span><span class='rparen'>)</span>
    <span class='backtick'>%x{</span><span class='tstring_content'>
      var flattened = </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_flatten'>flatten</span> <span class='id identifier rubyid_level'>level</span><span class='embexpr_end'>}</span><span class='tstring_content'>;

      if (self.length == flattened.length) {
        for (var i = 0, length = self.length; i &lt; length; i++) {
          if (self[i] !== flattened[i]) {
            break;
          }
        }

        if (i == length) {
          return nil;
        }
      }

      </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_replace'>replace</span> <span class='backtick'>`</span><span class='tstring_content'>flattened</span><span class='tstring_end'>`</span></span><span class='embexpr_end'>}</span><span class='tstring_content'>;
    </span><span class='tstring_end'>}</span></span>

    <span class='kw'>self</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_hash'>hash</span>
    <span class='backtick'>%x{</span><span class='tstring_content'>
      var hash = [&#39;A&#39;],
          item;
      for (var i = 0, length = self.length; i &lt; length; i++) {
        item = self[i];
        if (item.$$is_array &amp;&amp; </span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>self</span><span class='tstring_end'>`</span></span><span class='period'>.</span><span class='id identifier rubyid_eql?'>eql?</span><span class='lparen'>(</span><span class='backtick'>`</span><span class='tstring_content'>item</span><span class='tstring_end'>`</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>) {
          hash.push(&#39;self&#39;);
        } else {
          hash.push(item.$hash());
        }
      }
      return hash.join(&#39;,&#39;);
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_member'>member</span><span class='rparen'>)</span>
    <span class='backtick'>%x{</span><span class='tstring_content'>
      for (var i = 0, length = self.length; i &lt; length; i++) {
        if (</span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>self[i]</span><span class='tstring_end'>`</span></span> <span class='op'>==</span> <span class='id identifier rubyid_member'>member</span><span class='embexpr_end'>}</span><span class='tstring_content'>) {
          return true;
        }
      }

      return false;
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_object'>object</span><span class='op'>=</span><span class='id identifier rubyid_undefined'>undefined</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='backtick'>%x{</span><span class='tstring_content'>
      if (object != null) {
        for (var i = 0, length = self.length; i &lt; length; i++) {
          if (</span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>self[i]</span><span class='tstring_end'>`</span></span> <span class='op'>==</span> <span class='id identifier rubyid_object'>object</span><span class='embexpr_end'>}</span><span class='tstring_content'>) {
            return i;
          }
        }
      }
      else if (block !== nil) {
        for (var i = 0, length = self.length, value; i &lt; length; i++) {
          if ((value = block(self[i])) === $breaker) {
            return $breaker.$v;
          }

          if (value !== false &amp;&amp; value !== nil) {
            return i;
          }
        }
      }
      else {
        return </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_enum_for'>enum_for</span> <span class='symbol'>:index</span><span class='embexpr_end'>}</span><span class='tstring_content'>;
      }

      return nil;
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_insert'>insert</span><span class='lparen'>(</span><span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_objects'>objects</span><span class='rparen'>)</span>
    <span class='backtick'>%x{</span><span class='tstring_content'>
      index = </span><span class='embexpr_beg'>#{</span><span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_coerce_to'>coerce_to</span> <span class='backtick'>`</span><span class='tstring_content'>index</span><span class='tstring_end'>`</span></span><span class='comma'>,</span> <span class='const'>Integer</span><span class='comma'>,</span> <span class='symbol'>:to_int</span><span class='embexpr_end'>}</span><span class='tstring_content'>;

      if (objects.length &gt; 0) {
        if (index &lt; 0) {
          index += self.length + 1;

          if (index &lt; 0) {
            </span><span class='embexpr_beg'>#{</span> <span class='id identifier rubyid_raise'>raise</span> <span class='const'>IndexError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_index'>index</span><span class='embexpr_end'>}</span><span class='tstring_content'> is out of bounds</span><span class='tstring_end'>&quot;</span></span> <span class='embexpr_end'>}</span><span class='tstring_content'>;
          }
        }
        if (index &gt; self.length) {
          for (var i = self.length; i &lt; index; i++) {
            self.push(nil);
          }
        }

        self.splice.apply(self, [index, 0].concat(objects));
      }
    </span><span class='tstring_end'>}</span></span>

    <span class='kw'>self</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_inspect'>inspect</span>
    <span class='backtick'>%x{</span><span class='tstring_content'>
      var result = [],
          id     = </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid___id__'>__id__</span><span class='embexpr_end'>}</span><span class='tstring_content'>;

      for (var i = 0, length = self.length; i &lt; length; i++) {
        var item = </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='lbracket'>[</span><span class='backtick'>`</span><span class='tstring_content'>i</span><span class='tstring_end'>`</span></span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>;

        if (</span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>item</span><span class='tstring_end'>`</span></span><span class='period'>.</span><span class='id identifier rubyid___id__'>__id__</span><span class='embexpr_end'>}</span><span class='tstring_content'> === id) {
          result.push(&#39;[...]&#39;);
        }
        else {
          result.push(</span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>item</span><span class='tstring_end'>`</span></span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'>);
        }
      }

      return &#39;[&#39; + result.join(&#39;, &#39;) + &#39;]&#39;;
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_sep'>sep</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='backtick'>`</span><span class='tstring_content'>self.length === 0</span><span class='tstring_end'>`</span></span>

    <span class='kw'>if</span> <span class='backtick'>`</span><span class='tstring_content'>sep === nil</span><span class='tstring_end'>`</span></span>
      <span class='id identifier rubyid_sep'>sep</span> <span class='op'>=</span> <span class='gvar'>$,</span>
    <span class='kw'>end</span>

    <span class='backtick'>%x{</span><span class='tstring_content'>
      var result = [];
      var object_id = </span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>self</span><span class='tstring_end'>`</span></span><span class='period'>.</span><span class='id identifier rubyid_object_id'>object_id</span><span class='embexpr_end'>}</span><span class='tstring_content'>;

      for (var i = 0, length = self.length; i &lt; length; i++) {
        var item = self[i];

        if (</span><span class='embexpr_beg'>#{</span><span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span> <span class='backtick'>`</span><span class='tstring_content'>item</span><span class='tstring_end'>`</span></span><span class='comma'>,</span> <span class='symbol'>:to_str</span><span class='embexpr_end'>}</span><span class='tstring_content'>) {
          var tmp = </span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>item</span><span class='tstring_end'>`</span></span><span class='period'>.</span><span class='id identifier rubyid_to_str'>to_str</span><span class='embexpr_end'>}</span><span class='tstring_content'>;

          if (tmp !== nil) {
            result.push(</span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>tmp</span><span class='tstring_end'>`</span></span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_content'>);

            continue;
          }
        }

        if (</span><span class='embexpr_beg'>#{</span><span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span> <span class='backtick'>`</span><span class='tstring_content'>item</span><span class='tstring_end'>`</span></span><span class='comma'>,</span> <span class='symbol'>:to_ary</span><span class='embexpr_end'>}</span><span class='tstring_content'>) {
          var tmp = </span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>item</span><span class='tstring_end'>`</span></span><span class='period'>.</span><span class='id identifier rubyid_to_ary'>to_ary</span><span class='embexpr_end'>}</span><span class='tstring_content'>;

          if (object_id === </span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>tmp</span><span class='tstring_end'>`</span></span><span class='period'>.</span><span class='id identifier rubyid_object_id'>object_id</span><span class='embexpr_end'>}</span><span class='tstring_content'>) {
            </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='embexpr_end'>}</span><span class='tstring_content'>;
          }

          if (tmp !== nil) {
            result.push(</span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>tmp</span><span class='tstring_end'>`</span></span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_sep'>sep</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>);

            continue;
          }
        }

        if (</span><span class='embexpr_beg'>#{</span><span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span> <span class='backtick'>`</span><span class='tstring_content'>item</span><span class='tstring_end'>`</span></span><span class='comma'>,</span> <span class='symbol'>:to_s</span><span class='embexpr_end'>}</span><span class='tstring_content'>) {
          var tmp = </span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>item</span><span class='tstring_end'>`</span></span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_content'>;

          if (tmp !== nil) {
            result.push(tmp);

            continue;
          }
        }

        </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_raise'>raise</span> <span class='const'>NoMethodError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='lparen'>(</span><span class='backtick'>`</span><span class='tstring_content'>item</span><span class='tstring_end'>`</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'> doesn&#39;t respond to #to_str, #to_ary or #to_s</span><span class='tstring_end'>&quot;</span></span><span class='embexpr_end'>}</span><span class='tstring_content'>;
      }

      if (sep === nil) {
        return result.join(&#39;&#39;);
      }
      else {
        return result.join(</span><span class='embexpr_beg'>#{</span><span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_coerce_to!'>coerce_to!</span><span class='lparen'>(</span><span class='id identifier rubyid_sep'>sep</span><span class='comma'>,</span> <span class='const'>String</span><span class='comma'>,</span> <span class='symbol'>:to_str</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_content'>);
      }
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_keep_if'>keep_if</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_enum_for'>enum_for</span> <span class='symbol'>:keep_if</span> <span class='kw'>unless</span> <span class='id identifier rubyid_block_given?'>block_given?</span>

    <span class='backtick'>%x{</span><span class='tstring_content'>
      for (var i = 0, length = self.length, value; i &lt; length; i++) {
        if ((value = block(self[i])) === $breaker) {
          return $breaker.$v;
        }

        if (value === false || value === nil) {
          self.splice(i, 1);

          length--;
          i--;
        }
      }
    </span><span class='tstring_end'>}</span></span>

    <span class='kw'>self</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_last'>last</span><span class='lparen'>(</span><span class='id identifier rubyid_count'>count</span> <span class='op'>=</span> <span class='id identifier rubyid_undefined'>undefined</span><span class='rparen'>)</span>
    <span class='backtick'>%x{</span><span class='tstring_content'>
      if (count == null) {
        return self.length === 0 ? nil : self[self.length - 1];
      }

      count = </span><span class='embexpr_beg'>#{</span><span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_coerce_to'>coerce_to</span> <span class='backtick'>`</span><span class='tstring_content'>count</span><span class='tstring_end'>`</span></span><span class='comma'>,</span> <span class='const'>Integer</span><span class='comma'>,</span> <span class='symbol'>:to_int</span><span class='embexpr_end'>}</span><span class='tstring_content'>;

      if (count &lt; 0) {
        </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>negative array size</span><span class='tstring_end'>&#39;</span></span><span class='embexpr_end'>}</span><span class='tstring_content'>;
      }

      if (count &gt; self.length) {
        count = self.length;
      }

      return self.slice(self.length - count, self.length);
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_length'>length</span>
    <span class='backtick'>`</span><span class='tstring_content'>self.length</span><span class='tstring_end'>`</span></span>
  <span class='kw'>end</span>

  <span class='kw'>alias</span> <span class='id identifier rubyid_map'>map</span> <span class='id identifier rubyid_collect'>collect</span>

  <span class='kw'>alias</span> <span class='id identifier rubyid_map!'>map!</span> <span class='id identifier rubyid_collect!'>collect!</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_pop'>pop</span><span class='lparen'>(</span><span class='id identifier rubyid_count'>count</span> <span class='op'>=</span> <span class='id identifier rubyid_undefined'>undefined</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='backtick'>`</span><span class='tstring_content'>count === undefined</span><span class='tstring_end'>`</span></span>
      <span class='kw'>return</span> <span class='kw'>if</span> <span class='backtick'>`</span><span class='tstring_content'>self.length === 0</span><span class='tstring_end'>`</span></span>
      <span class='kw'>return</span> <span class='backtick'>`</span><span class='tstring_content'>self.pop()</span><span class='tstring_end'>`</span></span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_count'>count</span> <span class='op'>=</span> <span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_coerce_to'>coerce_to</span> <span class='id identifier rubyid_count'>count</span><span class='comma'>,</span> <span class='const'>Integer</span><span class='comma'>,</span> <span class='symbol'>:to_int</span>

    <span class='kw'>if</span> <span class='backtick'>`</span><span class='tstring_content'>count &lt; 0</span><span class='tstring_end'>`</span></span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>negative array size</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='backtick'>`</span><span class='tstring_content'>self.length === 0</span><span class='tstring_end'>`</span></span>

    <span class='kw'>if</span> <span class='backtick'>`</span><span class='tstring_content'>count &gt; self.length</span><span class='tstring_end'>`</span></span>
      <span class='backtick'>`</span><span class='tstring_content'>self.splice(0, self.length)</span><span class='tstring_end'>`</span></span>
    <span class='kw'>else</span>
      <span class='backtick'>`</span><span class='tstring_content'>self.splice(self.length - count, self.length)</span><span class='tstring_end'>`</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_product'>product</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='backtick'>%x{</span><span class='tstring_content'>
      var result = </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_block_given?'>block_given?</span><span class='embexpr_end'>}</span><span class='tstring_content'> ? null : [],
          n = args.length + 1,
          counters = new Array(n),
          lengths  = new Array(n),
          arrays   = new Array(n),
          i, m, subarray, len, resultlen = 1;

      arrays[0] = self;
      for (i = 1; i &lt; n; i++) {
        arrays[i] = </span><span class='embexpr_beg'>#{</span><span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_coerce_to'>coerce_to</span><span class='lparen'>(</span><span class='backtick'>`</span><span class='tstring_content'>args[i - 1]</span><span class='tstring_end'>`</span></span><span class='comma'>,</span> <span class='const'>Array</span><span class='comma'>,</span> <span class='symbol'>:to_ary</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>;
      }

      for (i = 0; i &lt; n; i++) {
        len = arrays[i].length;
        if (len === 0) {
          return result || self;
        }
        resultlen *= len;
        if (resultlen &gt; 2147483647) {
          </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_raise'>raise</span> <span class='const'>RangeError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>too big to product</span><span class='tstring_end'>&quot;</span></span><span class='embexpr_end'>}</span><span class='tstring_content'>
        }
        lengths[i] = len;
        counters[i] = 0;
      }

      outer_loop: for (;;) {
        subarray = [];
        for (i = 0; i &lt; n; i++) {
          subarray.push(arrays[i][counters[i]]);
        }
        if (result) {
          result.push(subarray);
        } else {
          </span><span class='embexpr_beg'>#{</span><span class='kw'>yield</span> <span class='backtick'>`</span><span class='tstring_content'>subarray</span><span class='tstring_end'>`</span></span><span class='embexpr_end'>}</span><span class='tstring_content'>
        }
        m = n - 1;
        counters[m]++;
        while (counters[m] === lengths[m]) {
          counters[m] = 0;
          if (--m &lt; 0) break outer_loop;
          counters[m]++;
        }
      }

      return result || self;
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_objects'>objects</span><span class='rparen'>)</span>
    <span class='backtick'>%x{</span><span class='tstring_content'>
      for (var i = 0, length = objects.length; i &lt; length; i++) {
        self.push(objects[i]);
      }
    </span><span class='tstring_end'>}</span></span>

    <span class='kw'>self</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_rassoc'>rassoc</span><span class='lparen'>(</span><span class='id identifier rubyid_object'>object</span><span class='rparen'>)</span>
    <span class='backtick'>%x{</span><span class='tstring_content'>
      for (var i = 0, length = self.length, item; i &lt; length; i++) {
        item = self[i];

        if (item.length &amp;&amp; item[1] !== undefined) {
          if (</span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>item[1]</span><span class='tstring_end'>`</span></span> <span class='op'>==</span> <span class='id identifier rubyid_object'>object</span><span class='embexpr_end'>}</span><span class='tstring_content'>) {
            return item;
          }
        }
      }

      return nil;
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_reject'>reject</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_enum_for'>enum_for</span> <span class='symbol'>:reject</span> <span class='kw'>unless</span> <span class='id identifier rubyid_block_given?'>block_given?</span>

    <span class='backtick'>%x{</span><span class='tstring_content'>
      var result = [];

      for (var i = 0, length = self.length, value; i &lt; length; i++) {
        if ((value = block(self[i])) === $breaker) {
          return $breaker.$v;
        }

        if (value === false || value === nil) {
          result.push(self[i]);
        }
      }
      return result;
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_reject!'>reject!</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_enum_for'>enum_for</span> <span class='symbol'>:reject!</span> <span class='kw'>unless</span> <span class='id identifier rubyid_block_given?'>block_given?</span>

    <span class='id identifier rubyid_original'>original</span> <span class='op'>=</span> <span class='id identifier rubyid_length'>length</span>
    <span class='id identifier rubyid_delete_if'>delete_if</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>

    <span class='kw'>unless</span> <span class='id identifier rubyid_length'>length</span> <span class='op'>==</span> <span class='id identifier rubyid_original'>original</span>
      <span class='kw'>self</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_replace'>replace</span><span class='lparen'>(</span><span class='id identifier rubyid_other'>other</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='const'>Array</span> <span class='op'>===</span> <span class='id identifier rubyid_other'>other</span>
      <span class='id identifier rubyid_other'>other</span> <span class='op'>=</span> <span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_other'>other</span> <span class='op'>=</span> <span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_coerce_to'>coerce_to</span><span class='lparen'>(</span><span class='id identifier rubyid_other'>other</span><span class='comma'>,</span> <span class='const'>Array</span><span class='comma'>,</span> <span class='symbol'>:to_ary</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>
    <span class='kw'>end</span>

    <span class='backtick'>%x{</span><span class='tstring_content'>
      self.splice(0, self.length);
      self.push.apply(self, other);
    </span><span class='tstring_end'>}</span></span>

    <span class='kw'>self</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_reverse'>reverse</span>
    <span class='backtick'>`</span><span class='tstring_content'>self.slice(0).reverse()</span><span class='tstring_end'>`</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_reverse!'>reverse!</span>
    <span class='backtick'>`</span><span class='tstring_content'>self.reverse()</span><span class='tstring_end'>`</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_reverse_each'>reverse_each</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_enum_for'>enum_for</span> <span class='symbol'>:reverse_each</span> <span class='kw'>unless</span> <span class='id identifier rubyid_block_given?'>block_given?</span>

    <span class='id identifier rubyid_reverse'>reverse</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>
    <span class='kw'>self</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_rindex'>rindex</span><span class='lparen'>(</span><span class='id identifier rubyid_object'>object</span> <span class='op'>=</span> <span class='id identifier rubyid_undefined'>undefined</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='backtick'>%x{</span><span class='tstring_content'>
      if (object != null) {
        for (var i = self.length - 1; i &gt;= 0; i--) {
          if (</span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>self[i]</span><span class='tstring_end'>`</span></span> <span class='op'>==</span> <span class='backtick'>`</span><span class='tstring_content'>object</span><span class='tstring_end'>`</span></span><span class='embexpr_end'>}</span><span class='tstring_content'>) {
            return i;
          }
        }
      }
      else if (block !== nil) {
        for (var i = self.length - 1, value; i &gt;= 0; i--) {
          if ((value = block(self[i])) === $breaker) {
            return $breaker.$v;
          }

          if (value !== false &amp;&amp; value !== nil) {
            return i;
          }
        }
      }
      else if (object == null) {
        return </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_enum_for'>enum_for</span> <span class='symbol'>:rindex</span><span class='embexpr_end'>}</span><span class='tstring_content'>;
      }

      return nil;
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>end</span>
  
  <span class='kw'>def</span> <span class='id identifier rubyid_rotate'>rotate</span><span class='lparen'>(</span><span class='id identifier rubyid_n'>n</span><span class='op'>=</span><span class='int'>1</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_n'>n</span> <span class='op'>=</span> <span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_coerce_to'>coerce_to</span> <span class='id identifier rubyid_n'>n</span><span class='comma'>,</span> <span class='const'>Integer</span><span class='comma'>,</span> <span class='symbol'>:to_int</span>
    <span class='backtick'>%x{</span><span class='tstring_content'>
      var ary, idx, firstPart, lastPart;
      
      if (self.length === 1) {
        return self.slice();
      }
      if (self.length === 0) {
        return [];
      }
      
      ary = self.slice();
      idx = n % ary.length;
      
      firstPart = ary.slice(idx);
      lastPart = ary.slice(0, idx);
      return firstPart.concat(lastPart);
    </span><span class='tstring_end'>}</span></span> 
  <span class='kw'>end</span>
  
  <span class='kw'>def</span> <span class='id identifier rubyid_rotate!'>rotate!</span><span class='lparen'>(</span><span class='id identifier rubyid_cnt'>cnt</span><span class='op'>=</span><span class='int'>1</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>RuntimeError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>can&#39;t modify frozen Array</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_frozen?'>frozen?</span>

    <span class='backtick'>%x{</span><span class='tstring_content'>
      if (self.length === 0 || self.length === 1) {
        return self;
      }
    </span><span class='tstring_end'>}</span></span>
    <span class='id identifier rubyid_cnt'>cnt</span> <span class='op'>=</span> <span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_coerce_to'>coerce_to</span> <span class='id identifier rubyid_cnt'>cnt</span><span class='comma'>,</span> <span class='const'>Integer</span><span class='comma'>,</span> <span class='symbol'>:to_int</span>
    <span class='id identifier rubyid_ary'>ary</span> <span class='op'>=</span> <span class='id identifier rubyid_rotate'>rotate</span><span class='lparen'>(</span><span class='id identifier rubyid_cnt'>cnt</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_replace'>replace</span> <span class='id identifier rubyid_ary'>ary</span>
  <span class='kw'>end</span>
  
  <span class='kw'>def</span> <span class='id identifier rubyid_sample'>sample</span><span class='lparen'>(</span><span class='id identifier rubyid_n'>n</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_n'>n</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_empty?'>empty?</span>
    <span class='kw'>return</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>  <span class='kw'>if</span>  <span class='id identifier rubyid_n'>n</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_empty?'>empty?</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_n'>n</span>
      <span class='lparen'>(</span><span class='int'>1</span> <span class='op'>..</span> <span class='id identifier rubyid_n'>n</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span>
        <span class='kw'>self</span><span class='lbracket'>[</span><span class='id identifier rubyid_rand'>rand</span><span class='lparen'>(</span><span class='id identifier rubyid_length'>length</span><span class='rparen'>)</span><span class='rbracket'>]</span>
      <span class='rbrace'>}</span>
    <span class='kw'>else</span>
      <span class='kw'>self</span><span class='lbracket'>[</span><span class='id identifier rubyid_rand'>rand</span><span class='lparen'>(</span><span class='id identifier rubyid_length'>length</span><span class='rparen'>)</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_select'>select</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_enum_for'>enum_for</span> <span class='symbol'>:select</span> <span class='kw'>unless</span> <span class='id identifier rubyid_block_given?'>block_given?</span>

    <span class='backtick'>%x{</span><span class='tstring_content'>
      var result = [];

      for (var i = 0, length = self.length, item, value; i &lt; length; i++) {
        item = self[i];

        if ((value = Opal.yield1(block, item)) === $breaker) {
          return $breaker.$v;
        }

        if (value !== false &amp;&amp; value !== nil) {
          result.push(item);
        }
      }

      return result;
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_select!'>select!</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_enum_for'>enum_for</span> <span class='symbol'>:select!</span> <span class='kw'>unless</span> <span class='id identifier rubyid_block_given?'>block_given?</span>

    <span class='backtick'>%x{</span><span class='tstring_content'>
      var original = self.length;
      </span><span class='embexpr_beg'>#{</span> <span class='id identifier rubyid_keep_if'>keep_if</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span> <span class='embexpr_end'>}</span><span class='tstring_content'>;
      return self.length === original ? nil : self;
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_shift'>shift</span><span class='lparen'>(</span><span class='id identifier rubyid_count'>count</span> <span class='op'>=</span> <span class='id identifier rubyid_undefined'>undefined</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='backtick'>`</span><span class='tstring_content'>count === undefined</span><span class='tstring_end'>`</span></span>
      <span class='kw'>return</span> <span class='kw'>if</span> <span class='backtick'>`</span><span class='tstring_content'>self.length === 0</span><span class='tstring_end'>`</span></span>
      <span class='kw'>return</span> <span class='backtick'>`</span><span class='tstring_content'>self.shift()</span><span class='tstring_end'>`</span></span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_count'>count</span> <span class='op'>=</span> <span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_coerce_to'>coerce_to</span> <span class='id identifier rubyid_count'>count</span><span class='comma'>,</span> <span class='const'>Integer</span><span class='comma'>,</span> <span class='symbol'>:to_int</span>

    <span class='kw'>if</span> <span class='backtick'>`</span><span class='tstring_content'>count &lt; 0</span><span class='tstring_end'>`</span></span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>negative array size</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='backtick'>`</span><span class='tstring_content'>self.length === 0</span><span class='tstring_end'>`</span></span>

    <span class='backtick'>`</span><span class='tstring_content'>self.splice(0, count)</span><span class='tstring_end'>`</span></span>
  <span class='kw'>end</span>

  <span class='kw'>alias</span> <span class='id identifier rubyid_size'>size</span> <span class='id identifier rubyid_length'>length</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_shuffle'>shuffle</span>
    <span class='id identifier rubyid_clone'>clone</span><span class='period'>.</span><span class='id identifier rubyid_shuffle!'>shuffle!</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_shuffle!'>shuffle!</span>
    <span class='backtick'>%x{</span><span class='tstring_content'>
      for (var i = self.length - 1; i &gt; 0; i--) {
        var tmp = self[i],
            j   = Math.floor(Math.random() * (i + 1));

        self[i] = self[j];
        self[j] = tmp;
      }
    </span><span class='tstring_end'>}</span></span>

    <span class='kw'>self</span>
  <span class='kw'>end</span>

  <span class='kw'>alias</span> <span class='id identifier rubyid_slice'>slice</span> <span class='op'>[]</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_slice!'>slice!</span><span class='lparen'>(</span><span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_length'>length</span> <span class='op'>=</span> <span class='id identifier rubyid_undefined'>undefined</span><span class='rparen'>)</span>
    <span class='backtick'>%x{</span><span class='tstring_content'>
      if (index &lt; 0) {
        index += self.length;
      }

      if (length != null) {
        return self.splice(index, length);
      }

      if (index &lt; 0 || index &gt;= self.length) {
        return nil;
      }

      return self.splice(index, 1)[0];
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_sort'>sort</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>self</span> <span class='kw'>unless</span> <span class='backtick'>`</span><span class='tstring_content'>self.length &gt; 1</span><span class='tstring_end'>`</span></span>

    <span class='backtick'>%x{</span><span class='tstring_content'>
      if (!</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_block_given?'>block_given?</span><span class='embexpr_end'>}</span><span class='tstring_content'>) {
        block = function(a, b) {
          return </span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>a</span><span class='tstring_end'>`</span></span> <span class='op'>&lt;=&gt;</span> <span class='backtick'>`</span><span class='tstring_content'>b</span><span class='tstring_end'>`</span></span><span class='embexpr_end'>}</span><span class='tstring_content'>;
        };
      }

      try {
        return self.slice().sort(function(x, y) {
          var ret = block(x, y);

          if (ret === $breaker) {
            throw $breaker;
          }
          else if (ret === nil) {
            </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>comparison of </span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>x</span><span class='tstring_end'>`</span></span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> with </span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>y</span><span class='tstring_end'>`</span></span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> failed</span><span class='tstring_end'>&quot;</span></span><span class='embexpr_end'>}</span><span class='tstring_content'>;
          }

          return </span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>ret</span><span class='tstring_end'>`</span></span> <span class='op'>&gt;</span> <span class='int'>0</span><span class='embexpr_end'>}</span><span class='tstring_content'> ? 1 : (</span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>ret</span><span class='tstring_end'>`</span></span> <span class='op'>&lt;</span> <span class='int'>0</span><span class='embexpr_end'>}</span><span class='tstring_content'> ? -1 : 0);
        });
      }
      catch (e) {
        if (e === $breaker) {
          return $breaker.$v;
        }
        else {
          throw e;
        }
      }
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_sort!'>sort!</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='backtick'>%x{</span><span class='tstring_content'>
      var result;

      if (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_block_given?'>block_given?</span><span class='embexpr_end'>}</span><span class='tstring_content'>) {
        result = </span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>self.slice()</span><span class='tstring_end'>`</span></span><span class='period'>.</span><span class='id identifier rubyid_sort'>sort</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>;
      }
      else {
        result = </span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>self.slice()</span><span class='tstring_end'>`</span></span><span class='period'>.</span><span class='id identifier rubyid_sort'>sort</span><span class='embexpr_end'>}</span><span class='tstring_content'>;
      }

      self.length = 0;
      for(var i = 0, length = result.length; i &lt; length; i++) {
        self.push(result[i]);
      }

      return self;
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_take'>take</span><span class='lparen'>(</span><span class='id identifier rubyid_count'>count</span><span class='rparen'>)</span>
    <span class='backtick'>%x{</span><span class='tstring_content'>
      if (count &lt; 0) {
        </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='embexpr_end'>}</span><span class='tstring_content'>;
      }

      return self.slice(0, count);
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_take_while'>take_while</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='backtick'>%x{</span><span class='tstring_content'>
      var result = [];

      for (var i = 0, length = self.length, item, value; i &lt; length; i++) {
        item = self[i];

        if ((value = block(item)) === $breaker) {
          return $breaker.$v;
        }

        if (value === false || value === nil) {
          return result;
        }

        result.push(item);
      }

      return result;
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_to_a'>to_a</span>
    <span class='kw'>self</span>
  <span class='kw'>end</span>

  <span class='kw'>alias</span> <span class='id identifier rubyid_to_ary'>to_ary</span> <span class='id identifier rubyid_to_a'>to_a</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_to_h'>to_h</span>
    <span class='backtick'>%x{</span><span class='tstring_content'>
      var i, len = self.length, ary, key, val, hash = </span><span class='embexpr_beg'>#{</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='embexpr_end'>}</span><span class='tstring_content'>;

      for (i = 0; i &lt; len; i++) {
        ary = </span><span class='embexpr_beg'>#{</span><span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_coerce_to?'>coerce_to?</span><span class='lparen'>(</span><span class='backtick'>`</span><span class='tstring_content'>self[i]</span><span class='tstring_end'>`</span></span><span class='comma'>,</span> <span class='const'>Array</span><span class='comma'>,</span> <span class='symbol'>:to_ary</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>;
        if (!ary.$$is_array) {
          </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_raise'>raise</span> <span class='const'>TypeError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wrong element type </span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>ary</span><span class='tstring_end'>`</span></span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> at </span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>i</span><span class='tstring_end'>`</span></span><span class='embexpr_end'>}</span><span class='tstring_content'> (expected array)</span><span class='tstring_end'>&quot;</span></span><span class='embexpr_end'>}</span><span class='tstring_content'>
        }
        if (ary.length !== 2) {
          </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wrong array length at </span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>i</span><span class='tstring_end'>`</span></span><span class='embexpr_end'>}</span><span class='tstring_content'> (expected 2, was </span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>ary</span><span class='tstring_end'>`</span></span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span><span class='embexpr_end'>}</span><span class='tstring_content'>
        }
        key = ary[0];
        val = ary[1];
        hash.$store(key, val);
      }

      return hash;
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>end</span>

  <span class='kw'>alias</span> <span class='id identifier rubyid_to_s'>to_s</span> <span class='id identifier rubyid_inspect'>inspect</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_transpose'>transpose</span>
    <span class='kw'>return</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_empty?'>empty?</span>

    <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_max'>max</span>    <span class='op'>=</span> <span class='kw'>nil</span>

    <span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_row'>row</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='const'>Array</span> <span class='op'>===</span> <span class='id identifier rubyid_row'>row</span>
        <span class='id identifier rubyid_row'>row</span> <span class='op'>=</span> <span class='id identifier rubyid_row'>row</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_row'>row</span> <span class='op'>=</span> <span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_coerce_to'>coerce_to</span><span class='lparen'>(</span><span class='id identifier rubyid_row'>row</span><span class='comma'>,</span> <span class='const'>Array</span><span class='comma'>,</span> <span class='symbol'>:to_ary</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_max'>max</span> <span class='op'>||=</span> <span class='backtick'>`</span><span class='tstring_content'>row.length</span><span class='tstring_end'>`</span></span>

      <span class='kw'>if</span> <span class='backtick'>`</span><span class='tstring_content'>row.length</span><span class='tstring_end'>`</span></span> <span class='op'>!=</span> <span class='id identifier rubyid_max'>max</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>IndexError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>element size differs (</span><span class='embexpr_beg'>#{</span><span class='backtick'>`</span><span class='tstring_content'>row.length</span><span class='tstring_end'>`</span></span><span class='embexpr_end'>}</span><span class='tstring_content'> should be </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_max'>max</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>

      <span class='backtick'>`</span><span class='tstring_content'>row.length</span><span class='tstring_end'>`</span></span><span class='period'>.</span><span class='id identifier rubyid_times'>times</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
        <span class='id identifier rubyid_entry'>entry</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_entry'>entry</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_row'>row</span><span class='period'>.</span><span class='id identifier rubyid_at'>at</span><span class='lparen'>(</span><span class='id identifier rubyid_i'>i</span><span class='rparen'>)</span>
      <span class='rbrace'>}</span>
    <span class='rbrace'>}</span>

    <span class='id identifier rubyid_result'>result</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_uniq'>uniq</span>
    <span class='backtick'>%x{</span><span class='tstring_content'>
      var result = [],
          seen   = {};

      for (var i = 0, length = self.length, item, hash; i &lt; length; i++) {
        item = self[i];
        hash = item;

        if (!seen[hash]) {
          seen[hash] = true;

          result.push(item);
        }
      }

      return result;
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_uniq!'>uniq!</span>
    <span class='backtick'>%x{</span><span class='tstring_content'>
      var original = self.length,
          seen     = {};

      for (var i = 0, length = original, item, hash; i &lt; length; i++) {
        item = self[i];
        hash = item;

        if (!seen[hash]) {
          seen[hash] = true;
        }
        else {
          self.splice(i, 1);

          length--;
          i--;
        }
      }

      return self.length === original ? nil : self;
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_unshift'>unshift</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_objects'>objects</span><span class='rparen'>)</span>
    <span class='backtick'>%x{</span><span class='tstring_content'>
      for (var i = objects.length - 1; i &gt;= 0; i--) {
        self.unshift(objects[i]);
      }
    </span><span class='tstring_end'>}</span></span>

    <span class='kw'>self</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_values_at'>values_at</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_out'>out</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='semicolon'>;</span>

    <span class='id identifier rubyid_args'>args</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_elem'>elem</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_elem'>elem</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span> <span class='const'>Range</span>
        <span class='id identifier rubyid_finish'>finish</span> <span class='op'>=</span> <span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_coerce_to'>coerce_to</span> <span class='id identifier rubyid_elem'>elem</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='comma'>,</span> <span class='const'>Integer</span><span class='comma'>,</span> <span class='symbol'>:to_int</span>
        <span class='id identifier rubyid_start'>start</span> <span class='op'>=</span> <span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_coerce_to'>coerce_to</span> <span class='id identifier rubyid_elem'>elem</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='comma'>,</span> <span class='const'>Integer</span><span class='comma'>,</span> <span class='symbol'>:to_int</span>
        
        <span class='backtick'>%x{</span><span class='tstring_content'>
          if (start &lt; 0) {
            start = start + self.length;
            </span><span class='embexpr_beg'>#{</span><span class='kw'>next</span><span class='embexpr_end'>}</span><span class='tstring_content'>;
          }
        </span><span class='tstring_end'>}</span></span>

        <span class='backtick'>%x{</span><span class='tstring_content'>
          if (finish &lt; 0) {
            finish = finish + self.length;
          }
          if (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_elem'>elem</span><span class='period'>.</span><span class='id identifier rubyid_exclude_end?'>exclude_end?</span><span class='embexpr_end'>}</span><span class='tstring_content'>) {
            finish--;
          }
          if (finish &lt; start) {
            </span><span class='embexpr_beg'>#{</span><span class='kw'>next</span><span class='embexpr_end'>}</span><span class='tstring_content'>;
          }
        </span><span class='tstring_end'>}</span></span>

        <span class='id identifier rubyid_start'>start</span><span class='period'>.</span><span class='id identifier rubyid_upto'>upto</span><span class='lparen'>(</span><span class='id identifier rubyid_finish'>finish</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='id identifier rubyid_out'>out</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_at'>at</span><span class='lparen'>(</span><span class='id identifier rubyid_i'>i</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_i'>i</span> <span class='op'>=</span> <span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_coerce_to'>coerce_to</span> <span class='id identifier rubyid_elem'>elem</span><span class='comma'>,</span> <span class='const'>Integer</span><span class='comma'>,</span> <span class='symbol'>:to_int</span>
        <span class='id identifier rubyid_out'>out</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_at'>at</span><span class='lparen'>(</span><span class='id identifier rubyid_i'>i</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_out'>out</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_zip'>zip</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_others'>others</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='backtick'>%x{</span><span class='tstring_content'>
      var result = [], size = self.length, part, o, i, j, jj;

      for (j = 0, jj = others.length; j &lt; jj; j++) {
        o = others[j];
        if (!o.$$is_array) {
          others[j] = </span><span class='embexpr_beg'>#{</span><span class='lparen'>(</span>
            <span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_coerce_to?'>coerce_to?</span><span class='lparen'>(</span><span class='backtick'>`</span><span class='tstring_content'>o</span><span class='tstring_end'>`</span></span><span class='comma'>,</span> <span class='const'>Array</span><span class='comma'>,</span> <span class='symbol'>:to_ary</span><span class='rparen'>)</span> <span class='op'>||</span>
            <span class='const'>Opal</span><span class='period'>.</span><span class='id identifier rubyid_coerce_to!'>coerce_to!</span><span class='lparen'>(</span><span class='backtick'>`</span><span class='tstring_content'>o</span><span class='tstring_end'>`</span></span><span class='comma'>,</span> <span class='const'>Enumerator</span><span class='comma'>,</span> <span class='symbol'>:each</span><span class='rparen'>)</span>
          <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span><span class='embexpr_end'>}</span><span class='tstring_content'>;
        }
      }

      for (i = 0; i &lt; size; i++) {
        part = [self[i]];

        for (j = 0, jj = others.length; j &lt; jj; j++) {
          o = others[j][i];

          if (o == null) {
            o = nil;
          }

          part[j + 1] = o;
        }

        result[i] = part;
      }

      if (block !== nil) {
        for (i = 0; i &lt; size; i++) {
          block(result[i]);
        }

        return nil;
      }

      return result;
    </span><span class='tstring_end'>}</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre></div></div>

      <div id="footer">
  Generated on Fri Nov 27 11:10:08 2015 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.6 (ruby-2.2.3).
</div>

    </div>
  </body>
</html>