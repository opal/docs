<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>binary.js</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="../../../../../../../../../css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../../../../../../../../css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../../../../../../../../css/github.css" type="text/css" media="screen" />
<script src="../../../../../../../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../../../../../../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../../../../../../../js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../../../../../../../js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>

</head>

<body>     
    <div class="banner">
        
        <h1>
            binary.js
        </h1>
        <ul class="files">
            <li>opal/stdlib/nodejs/node_modules/js-yaml/lib/js-yaml/type/binary.js</li>
            <li>Last modified: 2015-08-19 03:18:33 +0200</li>
        </ul>
    </div>

    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<p>&#39;use strict&#39;;</p>

<p>// A trick for browserified version. // Since we make browserifier to
ignore `buffer` module, NodeBuffer will be undefined var NodeBuffer =
require(&#39;buffer&#39;).Buffer; var Type       =
require(&#39;../type&#39;);</p>

<p>// [ 64, 65, 66 ] -&gt; [ padding, CR, LF ] var BASE64_MAP =
&#39;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=nr&#39;;</p>

<p>function resolveYamlBinary(data) {</p>

<pre><code>if (null === data) {
  return false;
}

var code, idx, bitlen = 0, len = 0, max = data.length, map = BASE64_MAP;

// Convert one by one.
for (idx = 0; idx &lt; max; idx ++) {
  code = map.indexOf(data.charAt(idx));

  // Skip CR/LF
  if (code &gt; 64) { continue; }

  // Fail on illegal characters
  if (code &lt; 0) { return false; }

  bitlen += 6;
}

// If there are any bits left, source was corrupted
return (bitlen % 8) === 0;</code></pre>

<p>}</p>

<p>function constructYamlBinary(data) {</p>

<pre><code>var code, idx, tailbits,
    input = data.replace(/[\r\n=]/g, &#39;&#39;), // remove CR/LF &amp; padding to simplify scan
    max = input.length,
    map = BASE64_MAP,
    bits = 0,
    result = [];

// Collect by 6*4 bits (3 bytes)

for (idx = 0; idx &lt; max; idx++) {
  if ((idx % 4 === 0) &amp;&amp; idx) {
    result.push((bits &gt;&gt; 16) &amp; 0xFF);
    result.push((bits &gt;&gt; 8) &amp; 0xFF);
    result.push(bits &amp; 0xFF);
  }

  bits = (bits &lt;&lt; 6) | map.indexOf(input.charAt(idx));
}

// Dump tail

tailbits = (max % 4)*6;

if (tailbits === 0) {
  result.push((bits &gt;&gt; 16) &amp; 0xFF);
  result.push((bits &gt;&gt; 8) &amp; 0xFF);
  result.push(bits &amp; 0xFF);
} else if (tailbits === 18) {
  result.push((bits &gt;&gt; 10) &amp; 0xFF);
  result.push((bits &gt;&gt; 2) &amp; 0xFF);
} else if (tailbits === 12) {
  result.push((bits &gt;&gt; 4) &amp; 0xFF);
}

// Wrap into Buffer for NodeJS and leave Array for browser
if (NodeBuffer) {
  return new NodeBuffer(result);
}

return result;</code></pre>

<p>}</p>

<p>function representYamlBinary(object   , style  ) {</p>

<pre><code>var result = &#39;&#39;, bits = 0, idx, tail,
    max = object.length,
    map = BASE64_MAP;

// Convert every three bytes to 4 ASCII characters.

for (idx = 0; idx &lt; max; idx++) {
  if ((idx % 3 === 0) &amp;&amp; idx) {
    result += map[(bits &gt;&gt; 18) &amp; 0x3F];
    result += map[(bits &gt;&gt; 12) &amp; 0x3F];
    result += map[(bits &gt;&gt; 6) &amp; 0x3F];
    result += map[bits &amp; 0x3F];
  }

  bits = (bits &lt;&lt; 8) + object[idx];
}

// Dump tail

tail = max % 3;

if (tail === 0) {
  result += map[(bits &gt;&gt; 18) &amp; 0x3F];
  result += map[(bits &gt;&gt; 12) &amp; 0x3F];
  result += map[(bits &gt;&gt; 6) &amp; 0x3F];
  result += map[bits &amp; 0x3F];
} else if (tail === 2) {
  result += map[(bits &gt;&gt; 10) &amp; 0x3F];
  result += map[(bits &gt;&gt; 4) &amp; 0x3F];
  result += map[(bits &lt;&lt; 2) &amp; 0x3F];
  result += map[64];
} else if (tail === 1) {
  result += map[(bits &gt;&gt; 2) &amp; 0x3F];
  result += map[(bits &lt;&lt; 4) &amp; 0x3F];
  result += map[64];
  result += map[64];
}

return result;</code></pre>

<p>}</p>

<p>function isBinary(object) {</p>

<pre><code>return NodeBuffer &amp;&amp; NodeBuffer.isBuffer(object);
</code></pre>

<p>}</p>

<p>module.exports = new Type(&#39;tag:yaml.org,2002:binary&#39;, {</p>

<pre><code>kind: &#39;scalar&#39;,
resolve: resolveYamlBinary,
construct: constructYamlBinary,
predicate: isBinary,
represent: representYamlBinary</code></pre>

<p>});</p>

    </div>
  


  


  
  


  


  

  



  

    

    

    


    


    <!-- Methods -->
              </div>

    </div>
  </body>
</html>
